<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Turner â€“ A Turn Randomizer</title>
    <style type="text/css">

body, input, button {
    font-family: monospace;
    font-size: 16pt;
}

body > div {
    margin-top: 1em;
}

.inline {
    display: inline-block;
    max-width: 45%;
    margin: 0 1em;
}

#randomize-turns-button {
    width: 10em;
    height: 2.5em;
}

#turns-list {
    font-weight: bold;
}

/* Hide keyboard specific hints on low resolutions (i.e. mobile devices) */
@media only screen and (max-width: 768px) {
    #hints {
        display: none;
    }
}

    </style>
</head>
<body>

    <div>
        <input id="name-field" type="text" placeholder="Write name here">
        <button id="add-button">Add</button>
    </div>

    <div>
        <button id="randomize-turns-button">Randomize</button>
    </div>

    <div id="hints">
        <div>Press Ctrl + Enter to randomize.</div>
        <div>Press Ctrl + Delete to remove all names.</div>
    </div>

    <div>
        <div id="names-list" class="inline">
        </div>
        <div id="turns-list" class="inline">
        </div>
    </div>

    <div>
        <button id="delete-selected-button">Delete Selected</button>
        <button id="delete-all-button">Delete All</button>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script type="text/javascript">

$(document).ready(function () {

    $(document).keydown(function (event) {
        if (event.ctrlKey) {
            if (event.which == 13) { // Enter
                event.preventDefault()
                randomizeTurns()
            }
            else if (event.which === 46) { // Delete
                event.preventDefault()
                deleteNames(false)
            }
        }
    })

    var nameField = $('#name-field')

    nameField.keydown(function (event) {
        if (!event.ctrlKey && event.which == 13) { // Enter without Ctrl
            event.preventDefault()
            addNameFromNameField()
        }
    })

    nameField.focus()


    $('#add-button').click(function (event) {
        event.preventDefault()
        addNameFromNameField()
    })

    function addNameFromNameField() {
        var name = nameField.val()
        addName(name)
        nameField.val('')
        nameField.focus()
    }

    var turnsList = $('#turns-list')
    var namesList = $('#names-list')

    function addName(name) {
        var upperCaseName = name.toUpperCase()

        if (upperCaseName === '') {
            return
        }

        var nameCheckboxId = upperCaseName.replace(/[^\w\s]/gi, '') + '-checkbox'
        if ($('#' + nameCheckboxId).length > 0) {
            alert('Name "' + upperCaseName + '" is already on the list!')
            return
        }

        $('<div><input id="' + nameCheckboxId + '" type="checkbox" value="' + upperCaseName + '"><label for="' + nameCheckboxId +'">' + upperCaseName + '</label></div>').appendTo(namesList)

        turnsList.empty()
    }

    $('#delete-selected-button').click(function (event) {
        event.preventDefault()
        deleteNames(true)
    })

    function deleteNames(checkedOnly) {
        var checkboxes = namesList.find('input[type=checkbox]' + (checkedOnly ? ':checked' : ''))
        if (checkboxes.length > 0) {
            checkboxes.parent().remove()
            turnsList.empty()
        }
    }

    $('#delete-all-button').click(function (event) {
        event.preventDefault()
        deleteNames(false)
    })

    $('#randomize-turns-button').click(function (event) {
        event.preventDefault()
        randomizeTurns()
    })

    function randomizeTurns() {
        turnsList.empty()
        turnsList.css({
            'min-width': namesList.width()
        })

        var names = []
        namesList.find('input[type=checkbox]').each(function () {
            names.push($(this).val())
        })

        shuffleArray(names)

        // Durstenfeld shuffle, source: http://stackoverflow.com/a/12646864/1698168
        function shuffleArray(array) {
            for (var i = array.length - 1; i > 0; i--) {
                var j = Math.floor(Math.random() * (i + 1))
                var temp = array[i]
                array[i] = array[j]
                array[j] = temp
            }
            return array
        }

        $.each(names, function (index, name) {
            turnsList.append('<div>' + (index + 1) + '. ' + name + '</div>')
        })
    }

})

    </script>
</body>
</html>